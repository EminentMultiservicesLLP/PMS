var jLinq;(function(){var library=function(settings){var _jLinq=this;var _p={};_p.settings=settings;_jLinq.finish=function(lock){_jLinq.finish=null;_p.loaded=true;_p.lock=lock;};_p.util={format:function(msg,args){return msg.toString().replace(/%[0-9]+%/gi,function(match){var index=parseInt(match.replace(/%/gi,""));return args[index];});},allValues:function(list){var actual=[];for(var i=0;i<list.length;i++){if(list[i]==null){return actual;}
actual.push(list[i]);}
return actual;},trim:function(val){if(val==null){return"";}
return val.toString().replace(/^\s+|\s+$/,"");},empty:function(list){for(var i=0;i<list.length;i++){if(list[i]){return false;}}
return true;},type:function(val){if(val==null){return"null";}
if(val==undefined){return"null";}
for(var item in _p.types){try{if(_p.types[item](val)){return item;}}
catch(e){}}
return(typeof(val)).toString().toLowerCase();},when:function(val,actions){var type=_p.util.type(val);if(!actions[type]){if(actions.empty&&(val==null||val==undefined)){return actions.empty(val);}
if(actions.other){return actions.other(val);}
return false;}
try{return actions[type](val);}
catch(e){return false;}},as:function(val,actions){var type=_p.util.type(val);if(!actions[type]){if(actions.empty&&(val==null||val==undefined)){return actions.empty(val);}
if(actions.other){return actions.other(val);}
return null;}
try{return actions[type](val);}
catch(e){return null;}},each:function(array,action){var results=[];for(var i=0;i<array.length;i++){try{results.push(action(array[i],i));}
catch(e){results.push(e);}}
return results;},clone:function(obj){function gen(){};gen.prototype=obj;return new gen();}};_jLinq.addType=function(name,compare){name=_p.util.trim(name).toLowerCase();_p.types[name]=compare;};_jLinq.removeType=function(name){name=_p.util.trim(name).toLowerCase();_p.types[name]=function(){return false;};};_p.types=settings.types?settings.types:{};_jLinq.extend=function(params){params.name=_p.util.trim(params.name);params.namespace=_p.util.trim(params.namespace);if(_p.extend.hasCmd(params)){if(_p.lock){throw"Exception: Library is locked.";}
_p.extend.removeCmd(params);}
_p.extend.addCmd(params);if(params.type.match(/source/i)){if(params.namespace&&!_jLinq[params.namespace]){_jLinq[params.namespace]={};}
var target=params.namespace==""?_jLinq:_jLinq[params.namespace];target[params.name]=function(v1,v2,v3,v4,v5,v6,v7,v8,v9,v10,v11,v12,v13,v14,v15,v16,v17,v18,v19,v20,v21,v22,v23,v24,v25){var results=params.method({helper:_p.util},v1,v2,v3,v4,v5,v6,v7,v8,v9,v10,v11,v12,v13,v14,v15,v16,v17,v18,v19,v20,v21,v22,v23,v24,v25);if(_p.util.type(results)!="array"){throw"Exception: A 'Source' extension must return an array for a jLinq query.";}
return new _p.query(results);};}};_p.extend={cmd:[],hasCmd:function(params){return(_p.extend.findCmd(params)!=null);},addCmd:function(params){_p.extend.removeCmd(params);_p.extend.cmd.push(params);},removeCmd:function(params){var index=_p.extend.findCmd(params);if(index){_p.extend.cmd.splice(index,1);}},findCmd:function(params){for(var i=0;i<_p.extend.cmd.length;i++){var method=_p.extend.cmd[i];if(method.name==params.name&&method.namespace==params.namespace){return i;}}
return null;}};_jLinq.showCommands=function(){return _p.util.clone(_p.extend.cmd);};for(var item in settings.extend){_jLinq.extend(settings.extend[item]);}
_p.query=function(data){var _query=this;data=_p.util.clone(data);var _s={};_s.state={properties:true,lastCommand:null,lastField:null,lastCommandName:null,paramCount:0,ignoreCase:true,or:false,not:false,data:data,useProperties:false,operator:"",debug:{onEvent:function(msg){},log:function(msg,args){_s.state.debug.onEvent(_p.util.format(msg,args));}}};if(data==null){return null;}
if(_p.util.type(data)=="array"&&data.length>0){_s.state.useProperties=(_p.util.type(data[0])=="object");}
_s.query={cache:[],str:[],appendCmd:function(action){_s.query.cache.push(action);var not=_s.state.not?"!":"";if(_s.query.cache.length==0){_s.state.operator="";}
_s.state.or=false;_s.state.not=false;_s.query.str.push([_s.state.operator,"(",not,"(_s.query.cache[",(_s.query.cache.length-1),"](record)))"].join(""));_s.state.operator="&&";},select:function(){if(_s.query.str.length==0){return{selected:_s.state.data,remaining:[]};}
var queryString=["query = function(record) {"+" return (",_s.query.str.join(""),"); };"].join("");var query;eval(queryString);var selected=[];var remaining=[];for(var i=0;i<_s.state.data.length;i++){var item=_s.state.data[i];try{if(query(item)){selected.push(item);}
else{remaining.push(item);}}
catch(e){_s.state.debug.log("Exception when evaluating the query for selection: %0%. query: %1%",[e,query]);remaining.push(item);}}
return{selected:selected,remaining:remaining};},getArgs:function(args){var values=[];var found=false;for(var i=args.length;i-->0;){if(args[i]==null&&!found){continue;}
found=true;values.push(args[i]);}
values.reverse();return values;},prepCmd:function(params,args){_s.state.lastCommand=params.command;_s.state.paramCount=params.count;_s.state.lastCommandName=params.name;var values=_s.query.getArgs(args);if(_s.state.useProperties&&values.length==params.count+1){_s.state.lastField=values.shift();}
return{arg:values,field:_s.state.lastField};},repeatCmd:function(v1,v2,v3,v4,v5,v6,v7,v8,v9,v10,v11,v12,v13,v14,v15,v16,v17,v18,v19,v20,v21,v22,v23,v24,v25){if(_s.helper.empty([v1,v2,v3,v4,v5,v6,v7,v8,v9,v10,v11,v12,v13,v14,v15,v16,v17,v18,v19,v20,v21,v22,v23,v24,v25])){return _query;}
return _s.state.lastCommand(v1,v2,v3,v4,v5,v6,v7,v8,v9,v10,v11,v12,v13,v14,v15,v16,v17,v18,v19,v20,v21,v22,v23,v24,v25);},performSort:function(records,field,desc){records.sort(function(a,b){a=eval("a."+field);b=eval("b."+field);return(a<b)?-1:(a>b)?1:0;});if(desc){records.reverse();}}};_s.helper={toRegex:function(val){if(val==null){return"";}
return val.toString().replace(/\*|\(|\)|\\|\/|\?|\.|\*|\+|\<|\>|\[|\]|\=|\&|\$|\^/gi,function(match){return("\\"+match);});},getNumericValue:function(obj){if(obj.length){return obj.length;}
return obj;},trim:_p.util.trim,match:function(val,exp){if(!(val&&exp)){return false;}
if(_s.helper.type(exp)=="regexp"){exp=exp.source;}
exp=new RegExp(exp,"g"+(_s.state.ignoreCase?"i":""));return(val.match(exp));},propsEqual:function(val1,val2){if(val1==null&&val2==null){return true;}
if(val1==null||val2==null){return false;}
for(var name in val1){if(val2[name]==undefined){return false;}
if(!_s.helper.equals(val1[name],val2[name])){return false;}}
return true;},equals:function(val1,val2){try{if(val1==null&&val2==null){return true;}
if((val1==null&&val2)||(val1&&val2==null)){return false;}
var val1Type=_s.helper.type(val1);var val2Type=_s.helper.type(val2);if(val1Type!=val2Type){return false;}
if(val1Type=="string"&&val2Type=="string"){return _s.helper.match(val1,"^"+val2+"$");}
if(val1Type=="string"&&val2Type=="regexp"){return _s.helper.match(val1,val2);}
if(val1Type=="number"||val1Type=="bool"){return(val1==val2);}
else if(val1Type=="array"||val1Type=="object"){if(val1.length!=val2.length){return false;}
for(var i=0;i<val1.length;i++){if(!_s.helper.equals(val1[i],val2[i])){return false;}}
return true;}
else{return(val1==val2);}}
catch(e){return false;}},allEqual:function(val1,val2){if(_p.helper.type(val1)!="array"){val1=[val1];}
for(var item in val1){if(!_p.helper.equals(val1[item],val2)){return false;}}
return true;},anyEqual:function(val1,val2){if(_p.helper.type(val1)!="array"){val1=[val1];}
for(var item in val1){if(!_p.helper.equals(val1[item],val2)){return true;}}
return false;},sort:function(records,sorting,desc){if(sorting==null){records.sort();if(desc){query.state.data.reverse();}
return records;}
var index=0;var doSort=function(records){records=_p.util.clone(records);var field=sorting[index].field;var desc=sorting[index].desc;if(index==sorting.length-1){_s.query.performSort(records,field,desc);return records;};_s.query.performSort(records,field,desc);var dist=_s.helper.distinct(records,field);index++;var results=[];for(var j=0;j<dist.length;j++){var sorted=doSort(dist[j].items);for(var k=0;k<sorted.length;k++){results.push(sorted[k]);}};return results;};return doSort(_s.state.data);},distinct:function(records,field){var dist=[];for(var i=0;i<records.length;i++){var val=records[i];var key=(field!=null)?eval(["(val.",field,")"].join("")):val;var added=false;for(var item in dist){if(dist[item].key===key){added=true;dist[item].items.push(val);break;}}
if(!added){dist.push({key:key,items:[val]});}}
return dist;},empty:_p.util.empty,type:_p.util.type,when:_p.util.when,each:_p.util.each,format:_p.util.format,clone:_p.util.clone,all:_p.util.allValues,as:_p.util.as};for(var item in _p.extend.cmd){(function(params){if(!(params.type||params.name||params.method)){return;}
if(params.type.match(/source/i)){return;}
if(params.namespace&&!_query[params.namespace]){_query[params.namespace]={};}
var target=params.namespace?_query[params.namespace]:_query;var method=(function(v1,v2,v3,v4,v5,v6,v7,v8,v9,v10,v11,v12,v13,v14,v15,v16,v17,v18,v19,v20,v21,v22,v23,v24,v25){_s.state.debug.log("Called command %0% '%1%()'.",[params.type,params.name]);var state={add:function(cmd){_s.query.str.push(cmd);},query:_query,state:_s.state,helper:_s.helper,repeat:function(v1,v2,v3,v4,v5,v6,v7,v8,v9,v10,v11,v12,v13,v14,v15,v16,v17,v18,v19,v20,v21,v22,v23,v24,v25){_s.query.repeatCmd(v1,v2,v3,v4,v5,v6,v7,v8,v9,v10,v11,v12,v13,v14,v15,v16,v17,v18,v19,v20,v21,v22,v23,v24,v25);}};if(params.type.match(/^query$/i)){var cmd=_s.query.prepCmd({command:target[params.name],count:params.count,name:params.name},[v1,v2,v3,v4,v5,v6,v7,v8,v9,v10,v11,v12,v13,v14,v15,v16,v17,v18,v19,v20,v21,v22,v23,v24,v25]);_s.query.appendCmd(function(record){try{state.value=_s.state.useProperties?eval("record."+cmd.field):record;}
catch(e){_s.state.debug.log("Exception when calling '%0%()' : %1%.",[params.name,e]);state.value=null;}
state.record=record;state.type=state.helper.type(state.value);state.when=function(actions){return _s.helper.when(state.value,actions);};return params.method(state,cmd.arg[0],cmd.arg[1],cmd.arg[2],cmd.arg[3],cmd.arg[4],cmd.arg[5],cmd.arg[6],cmd.arg[7],cmd.arg[8],cmd.arg[9],cmd.arg[10],cmd.arg[11],cmd.arg[12],cmd.arg[13],cmd.arg[14],cmd.arg[15],cmd.arg[16],cmd.arg[17],cmd.arg[18],cmd.arg[19],cmd.arg[20],cmd.arg[21],cmd.arg[22],cmd.arg[23],cmd.arg[24]);});return _query;}
else if(params.type.match(/^action$/i)){try{params.method(state,v1,v2,v3,v4,v5,v6,v7,v8,v9,v10,v11,v12,v13,v14,v15,v16,v17,v18,v19,v20,v21,v22,v23,v24,v25);}
catch(e){_s.state.debug.log("Exception when calling '%0%()' : %1%.",[params.name,e]);}
return _query;}
else if(params.type.match(/^selection$/i)){state.results=params.manual?[]:_s.query.select();state.select=_s.query.select;return params.method(state,v1,v2,v3,v4,v5,v6,v7,v8,v9,v10,v11,v12,v13,v14,v15,v16,v17,v18,v19,v20,v21,v22,v23,v24,v25);}
return _query;});target[params.name]=method;if(params.type.match(/^query$/i)&&(_p.settings.generate==null||_p.settings.generate)&&(params.generate==null||params.generate)){var altName=params.name.substr(0,1).toUpperCase()+params.name.substr(1,params.name.length-1);target["or"+altName]=function(v1,v2,v3,v4,v5,v6,v7,v8,v9,v10,v11,v12,v13,v14,v15,v16,v17,v18,v19,v20,v21,v22,v23,v24,v25){_s.state.operator="||";return method(v1,v2,v3,v4,v5,v6,v7,v8,v9,v10,v11,v12,v13,v14,v15,v16,v17,v18,v19,v20,v21,v22,v23,v24,v25);};target["and"+altName]=function(v1,v2,v3,v4,v5,v6,v7,v8,v9,v10,v11,v12,v13,v14,v15,v16,v17,v18,v19,v20,v21,v22,v23,v24,v25){_s.state.operator="&&";return method(v1,v2,v3,v4,v5,v6,v7,v8,v9,v10,v11,v12,v13,v14,v15,v16,v17,v18,v19,v20,v21,v22,v23,v24,v25);};target["not"+altName]=function(v1,v2,v3,v4,v5,v6,v7,v8,v9,v10,v11,v12,v13,v14,v15,v16,v17,v18,v19,v20,v21,v22,v23,v24,v25){_s.state.not=!_s.state.not;return method(v1,v2,v3,v4,v5,v6,v7,v8,v9,v10,v11,v12,v13,v14,v15,v16,v17,v18,v19,v20,v21,v22,v23,v24,v25);};target["andNot"+altName]=function(v1,v2,v3,v4,v5,v6,v7,v8,v9,v10,v11,v12,v13,v14,v15,v16,v17,v18,v19,v20,v21,v22,v23,v24,v25){_s.state.not=!_s.state.not;_s.state.operator="&&";return method(v1,v2,v3,v4,v5,v6,v7,v8,v9,v10,v11,v12,v13,v14,v15,v16,v17,v18,v19,v20,v21,v22,v23,v24,v25);};target["orNot"+altName]=function(v1,v2,v3,v4,v5,v6,v7,v8,v9,v10,v11,v12,v13,v14,v15,v16,v17,v18,v19,v20,v21,v22,v23,v24,v25){_s.state.not=!_s.state.not;_s.state.operator="||";return method(v1,v2,v3,v4,v5,v6,v7,v8,v9,v10,v11,v12,v13,v14,v15,v16,v17,v18,v19,v20,v21,v22,v23,v24,v25);};}})(_p.extend.cmd[item]);}
_query["or"]=function(v1,v2,v3,v4,v5,v6,v7,v8,v9,v10,v11,v12,v13,v14,v15,v16,v17,v18,v19,v20,v21,v22,v23,v24,v25){_s.state.operator="||";return _s.query.repeatCmd(v1,v2,v3,v4,v5,v6,v7,v8,v9,v10,v11,v12,v13,v14,v15,v16,v17,v18,v19,v20,v21,v22,v23,v24,v25);};_query["not"]=function(v1,v2,v3,v4,v5,v6,v7,v8,v9,v10,v11,v12,v13,v14,v15,v16,v17,v18,v19,v20,v21,v22,v23,v24,v25){_s.state.not=!query.state.not;return _s.query.repeatCmd(v1,v2,v3,v4,v5,v6,v7,v8,v9,v10,v11,v12,v13,v14,v15,v16,v17,v18,v19,v20,v21,v22,v23,v24,v25);};_query["and"]=function(v1,v2,v3,v4,v5,v6,v7,v8,v9,v10,v11,v12,v13,v14,v15,v16,v17,v18,v19,v20,v21,v22,v23,v24,v25){_s.state.operator="&&";return _s.query.repeatCmd(v1,v2,v3,v4,v5,v6,v7,v8,v9,v10,v11,v12,v13,v14,v15,v16,v17,v18,v19,v20,v21,v22,v23,v24,v25);};_query["orNot"]=function(v1,v2,v3,v4,v5,v6,v7,v8,v9,v10,v11,v12,v13,v14,v15,v16,v17,v18,v19,v20,v21,v22,v23,v24,v25){_s.state.operator="||";_s.state.not=!query.state.not;return _s.query.repeatCmd(v1,v2,v3,v4,v5,v6,v7,v8,v9,v10,v11,v12,v13,v14,v15,v16,v17,v18,v19,v20,v21,v22,v23,v24,v25);};_query["andNot"]=function(v1,v2,v3,v4,v5,v6,v7,v8,v9,v10,v11,v12,v13,v14,v15,v16,v17,v18,v19,v20,v21,v22,v23,v24,v25){_s.state.operator="||";_s.state.not=!query.state.not;return _s.query.repeatCmd(v1,v2,v3,v4,v5,v6,v7,v8,v9,v10,v11,v12,v13,v14,v15,v16,v17,v18,v19,v20,v21,v22,v23,v24,v25);};};};var _defaultLibrary=function(){return{locked:true,generate:true,types:{array:function(val){return(val.push&&val.pop&&val.reverse&&val.slice&&val.splice);},"function":function(val){return((typeof(val)).toString().match(/^function$/i));},string:function(val){return((typeof(val)).toString().match(/^string$/i));},number:function(val){return((typeof(val)).toString().match(/^number$/i));},bool:function(val){return((typeof(val)).toString().match(/^boolean$/i));},regexp:function(val){return(val.ignoreCase!=null&&val.global!=null&&val.exec);},date:function(val){return(val.getTime&&val.setTime&&val.toDateString&&val.toTimeString);}},extend:[{name:"from",type:"source",method:function(query,source){return query.helper.when(source,{"function":function(){return source();},array:function(){return source;},other:function(){return[source];}});}},{name:"debug",type:"action",operators:false,method:function(query,delegate){query.state.debug.onEvent=delegate;}},{name:"reverse",type:"action",method:function(query){query.state.data.reverse();}},{name:"ignoreCase",type:"action",method:function(query){query.state.ignoreCase=true;}},{name:"useCase",type:"action",method:function(query){query.state.ignoreCase=false;}},{name:"combine",type:"action",method:function(query,delegate){query.add(query.state.operator+"("+(query.state.not?"!":""));query.state.operator="";delegate(query.query);query.add(")");}},{name:"orCombine",type:"action",method:function(query,delegate){query.state.operator="||";query.add(query.state.operator+"("+(query.state.not?"!":""));query.state.operator="";delegate(query.query);query.add(")");}},{name:"where",count:-1,type:"query",method:function(query,delegate){return delegate(query.record,query.helper);}},{name:"has",count:1,type:"query",method:function(query,value){var use=parseInt(value.toString(),16);var compare=parseInt(query.value.toString(),16);return((compare&use)==use);}},{name:"equals",count:1,type:"query",method:function(query,value){return query.helper.equals(query.value,value);}},{name:"startsWith",count:1,type:"query",method:function(query,value){if(query.helper.type(value)!="array"){value=[value];}
for(var item in value){var match=value[item];if(query.when({array:function(){return query.helper.equals(query.value[0],match)},other:function(){return query.helper.match(query.value.toString(),"^"+match.toString());}})){return true;};}}},{name:"endsWith",count:1,type:"query",method:function(query,value){if(query.helper.type(value)!="array"){value=[value];}
for(var item in value){var match=value[item];if(query.when({array:function(){return query.helper.equals(query.value[query.value.length-1],match)},other:function(){return query.helper.match(query.value.toString(),match.toString()+"$");}})){return true;};}}},{name:"contains",count:1,type:"query",method:function(query,value){if(value==null){return false;}
if(query.helper.type(value)!="array"){value=[value];}
for(var item in value){var match=value[item];if(query.when({array:function(){for(var i=0;i<query.value.length;i++){if(query.helper.equals(query.value[i],match)){return true;}}},other:function(){return query.helper.match(query.value.toString(),"^.*"+query.helper.toRegex(match)+".*$");}})){return true;};}}},{name:"match",count:1,type:"query",method:function(query,value){if(query.helper.type(value)!="array"){value=[value];}
for(var item in value){var match=value[item];if(query.when({array:function(){for(var i=0;i<query.value.length;i++){if(query.helper.match(query.value[i],match)){return true;}}},other:function(){return query.helper.match(query.value.toString(),match);}})){return true;};}}},{name:"less",count:1,type:"query",method:function(query,value){value=query.helper.when(value,{number:function(){return value;},date:function(){return value;},other:function(){return value.length;}});return query.when({string:function(){return(query.value.length<value);},array:function(){return(query.value.length<value);},other:function(){return(query.value<value);}});}},{name:"greater",count:1,type:"query",method:function(query,value){value=query.helper.when(value,{number:function(){return value;},date:function(){return value;},other:function(){return value.length;}});return query.when({string:function(){return(query.value.length>value);},array:function(){return(query.value.length>value);},other:function(){return(query.value>value);}});}},{name:"lessEquals",count:1,type:"query",method:function(query,value){value=query.helper.when(value,{number:function(){return value;},date:function(){return value;},other:function(){return value.length;}});return query.when({string:function(){return(query.value.length<=value);},array:function(){return(query.value.length<=value);},other:function(){return(query.value<=value);}});}},{name:"greaterEquals",count:1,type:"query",method:function(query,value){value=query.helper.when(value,{number:function(){return value;},date:function(){return value;},other:function(){return value.length;}});return query.when({string:function(){return(query.value.length>=value);},array:function(){return(query.value.length>=value);},other:function(){return(query.value>=value);}});}},{name:"between",count:2,type:"query",method:function(query,low,high){low=query.helper.when(low,{number:function(){return low;},date:function(){return value;},other:function(){return low.length;}});high=query.helper.when(high,{number:function(){return high;},other:function(){return high.length;}});return query.when({string:function(){return(query.value.length>low&&query.value.length<high);},array:function(){return(query.value.length>low&&query.value.length<high);},other:function(){return(query.value>low&&query.value<high);}});}},{name:"betweenEquals",count:2,type:"query",method:function(query,low,high){low=query.helper.when(low,{number:function(){return low;},date:function(){return value;},other:function(){return low.length;}});high=query.helper.when(high,{number:function(){return high;},date:function(){return value;},other:function(){return high.length;}});return query.when({string:function(){return(query.value.length>=low&&query.value.length<=high);},array:function(){return(query.value.length>=low&&query.value.length<=high);},other:function(){return(query.value>=low&&query.value<=high);}});}},{name:"empty",count:0,type:"query",method:function(query){return query.when({array:function(){return(query.value.length==0);},string:function(){return(query.value=="");},empty:function(){return query.value==null;}});}},{name:"is",count:0,type:"query",method:function(query){return query.when({bool:function(){return query.value;},empty:function(){return false;},other:function(){return(query.value!=null);}});}},{name:"isNot",count:0,type:"query",method:function(query){return query.when({bool:function(){return!query.value;},empty:function(){return true;},other:function(){return(query.value==null);}});}},{name:"any",type:"selection",method:function(query){return(query.results.selected.length>0);}},{name:"all",type:"selection",method:function(query){return(query.results.selected.length==query.state.data.length);}},{name:"none",type:"selection",method:function(query){return!query.query.all();}},{name:"count",type:"selection",method:function(query,invert){return invert?query.results.remaining.length:query.results.selected.length;}},{name:"select",type:"selection",method:function(query,selection,invert){var records=[];var results=invert?query.results.remaining:query.results.selected;selection=query.helper.type(selection)=="function"?selection:function(r){return r;};for(var i=0;i<results.length;i++){records.push(selection(results[i]));}
return records;}},{name:"toTable",type:"selection",manual:true,method:function(query,params,selection,invert){params=params?params:{};var results=query.query.select(selection,invert);if(results.count==0){return"No results for this query";}
var getString=function(raw){query.helper.when(raw,{date:function(){raw=query.helper.format("%0%/%1%/%2% at %3%:%4% %5%",[raw.getMonth()+1,raw.getDate(),raw.getFullYear(),(raw.getHours()>12?raw.getHours()-12:raw.getHours()),raw.getMinutes(),(raw.getHours()>12?"PM":"AM")]);},empty:function(){raw="null";},other:function(){raw=raw.toString();}});return raw;};var output=["<table cellpadding='0' cellspacing='0' "+(params.border?"border='"+params.border+"' ":"")+(params.css?"class='"+params.css+"' ":"")+" >"];if(query.state.useProperties){var columns=[];output.push("<tr>");for(var item in results[0]){columns.push(item);output.push("<th>");output.push(escape(item));output.push("</th>");}
output.push("</tr>");}
var alt=true;for(var i=0;i<results.length;i++){alt=!alt;var record=results[i];output.push("<tr "+(alt?"class='alt-row'":"")+">");if(query.state.useProperties){for(var col in columns){var item=columns[col];var val=record[item];var msg=getString(val);output.push("<td>");output.push(msg);output.push("</td>");}}
else{output.push("<td>");output.push(getString(record));output.push("</td>");}
output.push("</tr>");}
output.push("</table>");return output.join("");}},{name:"each",type:"selection",manual:true,method:function(query,action,selection,invert){var results=query.query.select(selection,invert);for(var i=0;i<results.length;i++){action(results[i],i);}
return query.query;}},{name:"orderBy",type:"selection",manual:true,method:function(query,v1,v2,v3,v4,v5,v6,v7,v8,v9,v10,v11,v12,v13,v14,v15,v16,v17,v18,v19,v20,v21,v22,v23,v24,v25){var order=query.helper.all([v1,v2,v3,v4,v5,v6,v7,v8,v9,v10,v11,v12,v13,v14,v15,v16,v17,v18,v19,v20,v21,v22,v23,v24,v25]);if(order.length==0){order=[""];}
if(!query.state.useProperties){var desc=(order.length>0)?(order[0]+"").match(/^\-/g):false;query.state.data=query.helper.sort(query.state.data,null,desc);return query.query;}
var sorting=[];for(var i=0;i<order.length;i++){sorting.push({desc:(order[i].substr(0,1)=="-"),field:order[i].replace(/^\-/g,"")});}
query.state.data=query.helper.sort(query.state.data,sorting);return query.query;}},{name:"distinct",type:"selection",method:function(query,field,invert){var sel=invert?query.results.remaining:query.results.selected;var results=query.helper.distinct(sel,field);var dist=[];for(var item in results){dist.push(results[item].key);}
return query.helper.sort(dist,null,false);}},{name:"groupBy",type:"selection",method:function(query,field,invert){var sel=invert?query.results.remaining:query.results.selected;var results=query.helper.distinct(sel,field);return jLinq.from(results);}},{name:"join",type:"selection",method:function(query,source,alias,pk,fk){source=query.helper.clone(source);var gen=[];for(var i=0;i<query.state.data.length;i++){var record=query.helper.clone(query.state.data[i]);var results=jLinq.from(source).equals(fk,record[pk]).select();if(results.length==1){record[alias]=results[0];}
else{record[i][alias]=results;}
gen.push(record);}
return jLinq.from(gen);}},{name:"attach",type:"selection",method:function(query,alias,delegate){for(var i=0;i<query.state.data.length;i++){query.state.data[i][alias]=delegate(query.state.data[i]);}}},{name:"skipTake",type:"selection",manual:true,method:function(query,skip,take,selection,invert){skip=Math.max(query.helper.type(skip)=="number"?skip:0,0);take=Math.max(query.helper.type(take)=="number"?take:0,0);var results=query.query.select(selection,invert);return results.slice(skip,(skip+take));}},{name:"take",type:"selection",manual:true,method:function(query,take,selection,invert){take=Math.max(query.helper.type(take)=="number"?take:0,0);var results=query.query.select(selection,invert);return results.slice(0,take);}},{name:"first",type:"selection",manual:true,method:function(query,defType,selection,invert){var results=query.query.select(selection,invert);return results.length>0?results[0]:defType?defType:null;}},{name:"last",type:"selection",manual:true,method:function(query,defType,selection,invert){var results=query.query.select(selection,invert);return results.length>0?results[results.length-1]:defType?defType:null;}},{name:"at",type:"selection",manual:true,method:function(query,index,defType,selection,invert){var results=query.query.select(selection,invert);return index<results.length||index>=0?results[index]:defType?defType:null;}},{name:"sum",type:"selection",method:function(query,field,invert){if(!query.state.useProperties){invert=field;}
var sel=invert?query.results.remaining:query.results.selected;var result=0;query.helper.each(sel,function(rec){if(query.state.useProperties){if(result==null){result=rec[field];}
else{query.helper.when(rec[field],{array:function(){result+=rec[field].length;},string:function(){result+=rec[field].length;},other:function(){result+=rec[field];}});}}
else{query.helper.when(rec,{array:function(){result+=rec.length;},string:function(){result+=rec.length;},other:function(){result+=rec;}});}});return{count:sel.length,result:result,records:sel};}},{name:"average",type:"selection",method:function(query,field,invert){var sel=invert?query.results.remaining:query.results.selected;var sum=jLinq.from(sel).sum(field).result;return{total:sum,count:sel.length,result:(sum/sel.length),records:sel};}},{name:"max",type:"selection",method:function(query,field,invert){var list=jLinq.from(invert?query.results.remaining:query.results.selected).select(function(r){r=query.state.useProperties?r[field]:r;return{value:r,count:query.helper.getNumericValue(r)}});return jLinq.from(list).orderBy("count","value").last()["value"];}},{name:"min",type:"selection",method:function(query,field,invert){var list=jLinq.from(invert?query.results.remaining:query.results.selected).select(function(r){r=query.state.useProperties?r[field]:r;return{value:r,count:query.helper.getNumericValue(r)}});return jLinq.from(list).orderBy("count","value").first()["value"];}},{name:"except",type:"selection",method:function(query,compare,invert){var selection=invert?query.results.remaining:query.results.selected;if(!(compare&&compare.length&&compare.length>0)){return jLinq.from(selection);}
var result=jLinq.from(selection).notWhere(function(val){for(var i=0;i<compare.length;i++){if(query.state.useProperties){if(query.helper.propsEqual(compare[i],val)){return true;}}
else{if(query.helper.equals(compare[i],val)){return true;}}}
return false;}).select();return jLinq.from(result);}},{name:"intersect",type:"selection",method:function(query,compare,invert){var selection=invert?query.results.remaining:query.results.selected;if(!(compare&&compare.length&&compare.length>0)){return jLinq.from(selection);}
var result=jLinq.from(selection).where(function(val){for(var i=0;i<compare.length;i++){if(query.state.useProperties){if(query.helper.propsEqual(compare[i],val)){return true;}}
else{if(query.helper.equals(compare[i],val)){return true;}}}
return false;}).select();return jLinq.from(result);}},{name:"union",type:"selection",method:function(query,compare,invert){var selection=invert?query.results.remaining:query.results.selected;if(!(compare&&compare.length&&compare.length>0)){return jLinq.from(selection);}
return jLinq.from(compare.concat(jLinq.from(selection).where(function(val){for(var i=0;i<compare.length;i++){if(query.state.useProperties){if(query.helper.propsEqual(compare[i],val)){return false;}}
else{if(query.helper.equals(compare[i],val)){return false;}}}
return true;}).select()));}},{name:"skipWhile",type:"selection",method:function(query,delegate,invert){var selection=invert?query.results.remaining:query.results.selected;var skip=true;return jLinq.from(selection).where(function(rec,helper){if(skip){skip=delegate(rec,helper);}
return!skip;}).select();}},{name:"takeWhile",type:"selection",method:function(query,delegate,invert){var selection=invert?query.results.remaining:query.results.selected;var take=true;return jLinq.from(selection).where(function(rec,helper){if(take){take=delegate(rec,query.helper);}
return take;}).select();}},{name:"selectMany",type:"selection",method:function(query,collection,delegate,select,invert){var selection=invert?query.results.remaining:query.results.selected;select=select?select:function(r,s){return{source:r,compare:s};};var results=[];query.helper.each(selection,function(rec){query.helper.each(collection,function(sub){if(delegate(rec,sub)){results.push(select(rec,sub));}});});return results;}}]};};jLinq=new library(_defaultLibrary());jLinq.finish(true);jLinq.library=function(settings,imp){if(imp==null){imp=true;}
var lib=new library(_defaultLibrary());if(!imp){lib.types={};lib.extend=[];}
var lock=false;if(settings){if(settings.extend){for(var ext in settings.extend){lib.extend(settings.extend[ext])}}
if(settings.types){for(var type in settings.types){lib.addType(settings.types[type]);;}}
if(settings.locked){lock=settings.locked;}};lib.finish(lock);return lib;};})();